<%- include('header'); -%>

<%- include('navigation'); -%>

    <div class="container">

    <!-- Country Summary -->
    <div class="container text-center justify-content-center mt-2 mb-2 p-3">
        <div class="row">
            <div class="col-12 col-lg-8 text-muted">
                <h2 class="text-dark"><%= trip.Country %></h2>
                <p class="card-text d-none d-md-block"><%= trip.Description %></p>
            </div>
            <div class="col-lg-4 d-none d-lg-flex align-items-center justify-content-center">
                <img src="/static/images/<%= trip.Continent %>/<%= trip.Country %>/<%= trip.Featured_Pic %>" class="img-fluid rounded" alt="Picture of <%= trip.Country %>">
            </div>
        </div>
    </div>
    
    <!-- Image Carousel -->
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-8">
                <div id="carouselPictures" class="carousel slide carousel-fade mt-3 mb-3" style="height: 500px;">
                    
                    <!-- Inner part of carousel which has ejs logic to look over list of destinations which has been passed in through the routing after running an SQL select query -->
                    <div class="carousel-inner" style="height: 100%; overflow: hidden; border-radius: 25px;">
                        <% destinations.forEach(function(destination, index) { %>
                            <div class="carousel-item <%= index === 0 ? 'active' : '' %>" style="height: 100%;">
                                <img src="/static/images/<%= trip.Continent %>/<%= trip.Country %>/<%= destination.Dest_Pic %>" class="d-block w-100" style="object-fit: cover; height: 100%;" alt="Picture of <%= destination.Dest_Name %>s in <%= trip.Country %>">
                                <div class="carousel-caption" style="text-shadow: 1px 1px 1px black">
                                    <h5><%= destination.Dest_Name %></h5>
                                    <p class="d-none d-md-block"><%= destination.Dest_Description %></p>
                                </div>
                            </div>
                        <% }); %>
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselPictures" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span style="text-shadow: 1px 1px 1px black">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselPictures" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span style="text-shadow: 1px 1px 1px black">Next</span>
                    </button>

                </div>
            </div>
        </div>
    </div>
    


    <!-- Different country info -->
    <div class="container text-center mt-4">
        <div class="row">
            <div class="col-4">
                <h5><u>Who for</u>:</h5>
                <div class="d-flex justify-content-center">
                    <ul class="list-unstyled">
                        <li>Ages: <%= trip.Ages %></li>
                        <li>Group size: <%= trip.Group_Size %></li>
                        <li>Accomodation: <%= trip.Accommodation %></li>
                    </ul>
                </div>
            </div>
            <div class="col-4">
                <h5><u>Main Destinations</u>:</h5>
                <div class="d-flex justify-content-center">
                    <ul class="list-unstyled">
                        <% destinations.forEach(function(destination, index) { %>
                            <li><%=destination.Dest_Name %></li>
                        <% }); %>
                    </ul>
                </div>
            </div>
            <div class="col-4">
                <h5><u>Tour info</u>:</h5>
                <div class="d-flex justify-content-center">
                    <ul class="list-unstyled">
                        <li>Cost: $<%= trip.Cost %></li>
                        <li>Length: <%= trip.Length %> days</li>
                        <li>Start: <%= trip.Start_Date %></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!-- API results -->
    <div class="row d-none d-md-flex justify-content-center align-items-center mt-3 mb-5">
        
        <!-- Info card for country info-->
        <div class="col-md-5">
            <div class="card">
                <img src="<%= countryData.flags.png %>" class="card-img-top" style="height: 300px; object-fit: cover;" alt="<%= countryData.flags.alt %>">
                <div class="card-body d-flex flex-column">
                    <h4><strong><%= trip.Country %> facts</strong></h4>
                    <ul>
                        <li>Capital City: <%= countryData.capital[0] %></li>
                        <li>Official Name: <%= countryData.name.official %></li>
                        <li>Population: <%= countryData.population %></li>
                        <li>Area: <%= countryData.area %>km2</li>
                        <li>Sub-Region: <%= countryData.subregion %></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Info card for country weather-->
        <div class="col-md-3">
            <div class="card">
                <img class="mx-auto d-block" src="https://openweathermap.org/img/wn/<%= weatherData.weather[0].icon %>@2x.png" alt="<%= weatherData.weather[0].description %>" width="30%">
                <div class="card-body d-flex flex-column">
                    <p>At the moment the weather in <%= countryData.capital[0] %> is <em><%= weatherData.weather[0].description %></em></p>
                    <ul>
                        <li>Temperature: <%= weatherData.main.temp %> °C</li>
                        <li>Range: <%= weatherData.main.temp_min %> °C - <%= weatherData.main.temp_max %> °C </li>
                        <li>Humidity: <%= weatherData.main.humidity %>%</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- API results (alt for small screens) -->
    <div class="row d-flex d-md-none justify-content-around align-items-center mt-3 mb-5">
        
        <!-- Info card for country info-->
        <div class="col-10 mt-3 mb-5">
            <div class="card">
                <img src="<%= countryData.flags.png %>" class="card-img-top" style="height: 300px; object-fit: cover;" alt="<%= countryData.flags.alt %>">
                <div class="card-body d-flex flex-column">
                    <h4><strong><%= trip.Country %> facts</strong></h4>
            
                    <ul>
                        <li>Capital City: <%= countryData.capital[0] %></li>
                        <li>Official Name: <%= countryData.name.official %></li>
                        <li>Population: <%= countryData.population %></li>
                        <li>Area: <%= countryData.area %>km2</li>
                        <li>Sub-Region: <%= countryData.subregion %></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Info card for country weather-->
        <div class="col-10">
            <div class="card">
                <img class="mx-auto d-block" src="https://openweathermap.org/img/wn/<%= weatherData.weather[0].icon %>@2x.png" alt="<%= weatherData.weather[0].description %>" width="30%">
                <div class="card-body d-flex flex-column">
                    <p>At the moment the weather in <%= countryData.capital[0] %> is <em><%= weatherData.weather[0].description %></em></p>
                  
                    <ul>
                        <li>Temperature: <%= weatherData.main.temp %> °C</li>
                        <li>Range: <%= weatherData.main.temp_min %> °C - <%= weatherData.main.temp_max %> °C </li>
                        <li>Humidity: <%= weatherData.main.humidity %>%</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Currency Convert Using API-->
    <div class="container text-center mb-4 mt-4">
        <div class="card p-4 shadow-sm">
            <h3>Currency Converter</h3>
            <h6>Current Exchange Rate: $1 to <%= countryData.currencies[Object.keys(countryData.currencies)[0]].symbol %> <%= exchangeRate %></h6>

            <div class="row justify-content-center mb-3">
                <div class="col-4">
                <label for="AUDAmount" class="form-label">Enter the amount of AUD:</label>
                <input type="number" id="AUDAmount" class="form-control" placeholder="AUD Amount" />
                </div>

                <div class="col-4">
                <label for="ForeignAmount" class="form-label"><%= countryData.currencies[Object.keys(countryData.currencies)[0]].name %> (<%= countryData.currencies[Object.keys(countryData.currencies)[0]].symbol %>)</label>
                <input type="number" id="ForeignAmount" class="form-control" placeholder="Exchange amount" />
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="map" style="height: 400px;"></div>
    </div>



    <!-- Different country quotes -->
    <div class="mb-5">
        <div id="carouselQuotes" class="carousel slide mt-3 mb-3 p-3 align-items-center" style="height: 200px;" data-bs-ride="carousel">
            <div class="carousel-inner" style="height: 200px;">

                <!-- For each Slides -->
                <% reviews.forEach(function(review, index) { %>
                <div class="carousel-item <%= index === 0 ? 'active' : '' %>" style="height: 200px;">
                    <div class="row align-items-center h-100">      
                        <!-- Image column -->
                        <div class="col-md-3 d-none d-md-block">
                            <img src="/static/images/<%= trip.Continent %>/<%= trip.Country %>/<%= review.Review_Pic %>" class="img-fluid rounded" style="object-fit: fill; height: 160px;" alt="Picture of tourist <%= review.Review_Name %>">
                        </div>
                        
                        <!-- Text column -->
                        <div class="col-md-9 text-secondary text-center">
                            <em>"<%= review.Review_Description %>"</em>
                            <div> -<%= review.Review_Name %></div>
                        </div>   
                    </div>
                </div>
                <% }); %>

                <!-- Controls -->
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselQuotes" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span style="text-shadow: 2px 2px 2px black">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselQuotes" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span style="text-shadow: 2px 2px 2px black">Next</span>
                </button>
            </div>
        </div>
    </div>
    </div>




    <script>
        var map = L.map('map').setView([<%- countryData.capitalInfo.latlng[0] %>, <%- countryData.capitalInfo.latlng[1] %>], 13);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var marker = L.marker([<%- countryData.capitalInfo.latlng[0] %>, <%- countryData.capitalInfo.latlng[1] %>]).addTo(map);
        marker.bindPopup("<b><%= countryData.capital[0] %></b>, the capital of <%= trip.Country %>.").openPopup();

        // Draw lines between all the destinations
        const destinationCoords = [
            [<%- countryData.capitalInfo.latlng[0] %>, <%- countryData.capitalInfo.latlng[1] %>],
            <% destinations.forEach(function(destination, index) { %>
                [<%= destination.latitude %>, <%= destination.longitude %>],
            <% }); %>
            [<%- countryData.capitalInfo.latlng[0] %>, <%- countryData.capitalInfo.latlng[1] %>]
        ];
        var route = L.polyline(destinationCoords, {color: 'blue', weight: 4}).addTo(map);
    </script>

    <% destinations.forEach(function(destination, index) { %>
        <script>
            // Add marker with a title and picture
            var marker = L.marker([<%- destination.latitude %>, <%- destination.longitude %>]).addTo(map);
            marker.bindPopup("<b><%= destination.Dest_Name %></b>, is one of our stops on our <%= trip.Country %> trip!<br>  <div style='text-align: center;'><img src='/static/images/<%= trip.Continent %>/<%= trip.Country %>/<%= destination.Dest_Pic %>' width=200></div>"); 
        </script>
    <% }); %>



    <script>
        // For handling currency conversions, the rate is passed into the page after an api call
        const AUDtoForeign = <%- exchangeRate %>;

        const AUDInput = document.getElementById('AUDAmount');
        const ForeignInput = document.getElementById('ForeignAmount');

        // When user types in AUD, update the foreign currency with the aud value*exchange rate
        AUDInput.addEventListener('input', () => {
            const val = parseFloat(AUDInput.value);
            if (!isNaN(val)) {
                ForeignInput.value = (val * AUDtoForeign).toFixed(2);
            } else {
                ForeignInput.value = '';
            }
        });

        // When user types in Foreign, update the AUD currency with the foreign value/(exchange rate)
        ForeignInput.addEventListener('input', () => {
            const val = parseFloat(ForeignInput.value);
            if (!isNaN(val)) {
                AUDInput.value = (val / AUDtoForeign).toFixed(2);
            } else {
                AUDInput.value = '';
            }
        });

    </script>




<%- include('footer'); -%>